{% extends "base.html" %}
{% block title %}Simulations{% endblock %}
{% block head %}
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <script src="{{ url_for('static', filename='js/simulations.js') }}" defer></script>
{% endblock %}
{% block content %}
<h1 class="mb-4">Simulations</h1>
{% from 'components/update_status.html' import status as update_status %}
<div class="row">
  <div class="col-lg-4 col-md-5 mb-4">
    <form id="sim-form">
      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title">Demographics</h5>
          <div class="mb-3">
            <label class="form-label">Age <span class="ms-1 text-muted" data-bs-toggle="tooltip" title="Age in years">?</span></label>
            <input type="range" class="form-range" name="age" id="age" min="0" max="120" value="{{ baseline.age }}">
            <div class="form-text"><span id="age-value">{{ baseline.age }}</span> years</div>
          </div>
          <div class="mb-3">
            <label class="form-label d-block">Sex</label>
            <div class="d-flex flex-wrap gap-2" role="group" aria-label="Sex">
              <input class="btn-check" type="radio" name="sex" id="sex-m" value="1" {% if baseline.sex==1 %}checked{% endif %}>
              <label class="btn btn-outline-danger btn-sm" for="sex-m">Male</label>
              <input class="btn-check" type="radio" name="sex" id="sex-f" value="0" {% if baseline.sex==0 %}checked{% endif %}>
              <label class="btn btn-outline-danger btn-sm" for="sex-f">Female</label>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label d-block">Chest Pain Type</label>
            <div class="d-flex flex-wrap gap-2" role="group" aria-label="Chest Pain Type">
              {% set cpt = baseline.chest_pain_type %}
              {% for v in ['typical_angina','atypical_angina','non-anginal','asymptomatic'] %}
              <input class="btn-check" type="radio" name="chest_pain_type" id="cpt-{{ v }}" value="{{ v }}" {% if cpt==v %}checked{% endif %}>
              <label class="btn btn-outline-danger btn-sm text-capitalize" for="cpt-{{ v }}">{{ v.replace('_', ' ') }}</label>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>

      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title">Clinical Measurements</h5>
          <div class="mb-3">
            <label class="form-label">Resting BP</label>
            <input type="range" class="form-range" name="resting_blood_pressure" id="bp" min="80" max="250" value="{{ baseline.resting_blood_pressure }}">
            <div class="form-text"><span id="bp-value">{{ baseline.resting_blood_pressure }}</span> mmHg</div>
          </div>
          <div class="mb-3">
            <label class="form-label">Cholesterol</label>
            <input type="range" class="form-range" name="cholesterol" id="chol" min="100" max="600" value="{{ baseline.cholesterol }}">
            <div class="form-text"><span id="chol-value">{{ baseline.cholesterol }}</span> mg/dL</div>
          </div>
          <div class="mb-3">
            <label class="form-label">Fasting Blood Sugar / Glucose (mg/dL)</label>
            <input type="range" class="form-range" name="fasting_blood_sugar" id="fbs" min="60" max="200" value="{{ baseline.fasting_blood_sugar }}">
            <div class="form-text"><span id="fbs-value">{{ baseline.fasting_blood_sugar }}</span> mg/dL</div>
          </div>
          <div class="mb-3">
            <label class="form-label d-block">Resting ECG</label>
            <div class="d-flex flex-wrap gap-2" role="group" aria-label="Resting ECG">
              {% set recg = baseline.Restecg %}
              {% for v in ['normal','left_ventricular_hypertrophy','st_t_wave_abnormality'] %}
              <input class="btn-check" type="radio" name="Restecg" id="recg-{{ v }}" value="{{ v }}" {% if recg==v %}checked{% endif %}>
              <label class="btn btn-outline-danger btn-sm text-capitalize" for="recg-{{ v }}">{{ v.replace('_', ' ') }}</label>
              {% endfor %}
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">Max Heart Rate</label>
            <input type="range" class="form-range" name="max_heart_rate_achieved" id="mhr" min="60" max="220" value="{{ baseline.max_heart_rate_achieved }}">
            <div class="form-text"><span id="mhr-value">{{ baseline.max_heart_rate_achieved }}</span> bpm</div>
          </div>
          <div class="mb-3">
            <label class="form-label d-block">Exercise Angina</label>
            <div class="d-flex flex-wrap gap-2" role="group" aria-label="Exercise Angina">
              <input class="btn-check" type="radio" name="exercise_induced_angina" id="angina-no" value="0" {% if baseline.exercise_induced_angina==0 %}checked{% endif %}>
              <label class="btn btn-outline-danger btn-sm" for="angina-no">No</label>
              <input class="btn-check" type="radio" name="exercise_induced_angina" id="angina-yes" value="1" {% if baseline.exercise_induced_angina==1 %}checked{% endif %}>
              <label class="btn btn-outline-danger btn-sm" for="angina-yes">Yes</label>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">ST Depression</label>
            <input type="range" step="0.1" class="form-range" name="st_depression" id="st_dep" min="0" max="6.2" value="{{ baseline.st_depression }}">
            <div class="form-text"><span id="st_dep-value">{{ baseline.st_depression }}</span></div>
          </div>
          <div class="mb-3">
            <label class="form-label d-block">ST Slope Type</label>
            <div class="d-flex flex-wrap gap-2" role="group" aria-label="ST Slope Type">
              {% set slope = baseline.st_slope_type %}
              {% for v in ['upsloping','flat','downsloping'] %}
              <input class="btn-check" type="radio" name="st_slope_type" id="slope-{{ v }}" value="{{ v }}" {% if slope==v %}checked{% endif %}>
              <label class="btn btn-outline-danger btn-sm text-capitalize" for="slope-{{ v }}">{{ v.replace('_', ' ') }}</label>
              {% endfor %}
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">Num Major Vessels</label>
            <input type="range" class="form-range" name="num_major_vessels" id="nmv" min="0" max="3" step="1" value="{{ baseline.num_major_vessels }}">
            <div class="form-text"><span id="nmv-value">{{ baseline.num_major_vessels }}</span></div>
          </div>
          <div class="mb-3">
            <label class="form-label d-block">Thalassemia Type</label>
            <div class="d-flex flex-wrap gap-2" role="group" aria-label="Thalassemia Type">
              {% set thal = baseline.thalassemia_type %}
              {% for v in ['normal','fixed_defect','reversible_defect'] %}
              <input class="btn-check" type="radio" name="thalassemia_type" id="thal-{{ v }}" value="{{ v }}" {% if thal==v %}checked{% endif %}>
              <label class="btn btn-outline-danger btn-sm text-capitalize" for="thal-{{ v }}">{{ v.replace('_', ' ') }}</label>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>

    </form>
  </div>
  <div class="col-lg-8 col-md-7">
    <div class="card mb-3">
      <div class="card-header d-flex align-items-center">
        <h2 class="h5 mb-0 flex-grow-1">Prediction Result</h2>
        {{ update_status() }}
      </div>
      <div class="card-body" id="prediction" aria-busy="false"></div>
    </div>
    <div class="card">
      <div class="card-body">
        <div id="exercise-angina-chart" style="height:350px;" aria-busy="false"></div>
      </div>
    </div>
    <div class="card mt-3">
      <div class="card-body">
        <div class="row g-3 align-items-end">
          <div class="col-md-6">
            <label class="form-label" for="variable">Variable</label>
            <select class="form-select" name="variable" id="variable">
              <option value="age" selected>Age</option>
              <option value="cholesterol">Cholesterol (mg/dL)</option>
              <option value="resting_blood_pressure">Resting Blood Pressure (systolic mmHg)</option>
              <option value="fasting_blood_sugar">Fasting Blood Sugar / Glucose (mg/dL)</option>
              <option value="max_heart_rate_achieved">Max Heart Rate Achieved (bpm)</option>
            </select>
          </div>
          <div class="col-md-6">
            <button class="btn btn-brand w-100" id="run-sim">Run</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

