{% extends "base.html" %}
{% block title %}Simulations{% endblock %}
{% block content %}
<h1 class="mb-4">Simulations</h1>

{% if features.what_if %}
<div class="mb-5">
  <h2>What-If Scenario</h2>
  <form method="get" class="row g-2 mb-3">
    <div class="col-md-3">
      <label class="form-label">Age</label>
      <input type="number" class="form-control" name="age" value="{{ request.args.get('age', 50) }}">
    </div>
    <div class="col-md-3">
      <label class="form-label">Cholesterol</label>
      <input type="number" class="form-control" name="cholesterol" value="{{ request.args.get('cholesterol', 200) }}">
    </div>
    <div class="col-md-3">
      <label class="form-label">Blood Pressure</label>
      <input type="number" class="form-control" name="resting_blood_pressure" value="{{ request.args.get('resting_blood_pressure', 120) }}">
    </div>
    <div class="col-md-2">
      <label class="form-label">Variable</label>
      <select class="form-select" name="variable">
        <option value="cholesterol" {% if request.args.get('variable','cholesterol') == 'cholesterol' %}selected{% endif %}>Cholesterol</option>
        <option value="resting_blood_pressure" {% if request.args.get('variable') == 'resting_blood_pressure' %}selected{% endif %}>Blood Pressure</option>
        <option value="age" {% if request.args.get('variable') == 'age' %}selected{% endif %}>Age</option>
      </select>
    </div>
    <div class="col-md-1 d-flex align-items-end">
      <button class="btn btn-brand w-100" type="submit">Run</button>
    </div>
  </form>
  {% if errors.what_if %}
  <div class="alert alert-danger">{{ errors.what_if }}</div>
  {% elif results.what_if %}
  <ul>
    {% for row in results.what_if.data %}
    <li>{{ results.what_if.variable }} = {{ row.value }} → {{ row.risk_pct }}%</li>
    {% endfor %}
  </ul>
  {% endif %}
</div>
{% endif %}

{% if features.age_projection %}
<div class="mb-5">
  <h2>Age Projection</h2>
  {% if errors.age_projection %}
  <div class="alert alert-danger">{{ errors.age_projection }}</div>
  {% elif results.age_projection %}
  <ul>
    {% for row in results.age_projection %}
    <li>Age {{ row.age }} → {{ row.risk_pct }}%</li>
    {% endfor %}
  </ul>
  {% endif %}
</div>
{% endif %}

{% endblock %}
