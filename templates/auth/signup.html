{% extends 'base.html' %}
{% from '_components/auth_card.html' import auth_card %}
{% from '_components/form_field.html' import form_field %}
{% from '_components/password_strength.html' import password_strength %}
{% from '_components/otp_inputs.html' import otp_inputs %}
{% from '_components/alerts.html' import render_flashes %}
{% from '_components/buttons.html' import primary %}

{% block title %}Sign Up{% endblock %}

{% block navbar %}
<nav class="navbar justify-content-end p-3">
  {% include 'components/theme_toggle.html' %}
</nav>
{% endblock %}

{% block flashes %}
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
  <div class="mb-3">{{ render_flashes(messages) }}</div>
  {% endif %}
{% endwith %}
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-md-6" id="signupSection">
      {% call auth_card('Create your account') %}
      <form id="signupForm" method="post" action="{{ url_for('auth.signup') }}" novalidate>
        {{ form.csrf_token }}
        {{ form_field('text', form.username.id, form.username.label.text, value=form.username.data or '', error='', attrs={'required':True, 'autocomplete':'username'}) }}
        {{ form_field('text', form.nickname.id, form.nickname.label.text, value=form.nickname.data or '', attrs={'autocomplete':'nickname'}) }}
        {{ form_field('email', form.email.id, form.email.label.text, value=form.email.data or '', error='', attrs={'required':True, 'autocomplete':'email'}) }}
        {{ form_field('password', form.password.id, form.password.label.text, help='Use 8+ characters with numbers and symbols', error='', attrs={'required':True, 'autocomplete':'new-password', 'aria-describedby': form.password.id + 'Help'}, slot='<button type="button" class="btn btn-outline-secondary password-toggle position-absolute top-50 end-0 translate-middle-y me-2" aria-label="Show password"><i class="bi bi-eye"></i></button>') }}
        {{ password_strength(form.password.id) }}
        {{ form_field('password', form.confirm.id, form.confirm.label.text, error='', attrs={'required':True, 'autocomplete':'new-password'}, slot='<button type="button" class="btn btn-outline-secondary password-toggle position-absolute top-50 end-0 translate-middle-y me-2" aria-label="Show password"><i class="bi bi-eye"></i></button>') }}
        <div class="mb-3">
          {{ form.role.label(class='form-label') }}
          {{ form.role(class='form-select', id=form.role.id, required=true) }}
        </div>
        <p class="small text-muted mb-3">By creating an account, you agree to our <a href="#">Terms</a> and <a href="#">Privacy Policy</a>.</p>
        <div class="d-grid mb-3">
          {{ primary('Create account', attrs={'id':'createAccount', 'type':'submit', 'disabled':True}) }}
        </div>
        <p class="text-center mb-0">Already have an account? <a href="{{ url_for('auth.login') }}">Sign in</a></p>
      </form>
      {% endcall %}
    </div>
  </div>
  <div class="row justify-content-center d-none" id="verifySection">
    <div class="col-md-6">
      {% call auth_card('Verify your email') %}
      <p class="text-muted small">Enter the 6-digit code sent to your email.</p>
      <form id="verifyForm" novalidate>
        {{ otp_inputs(name='otp') }}
        <div class="d-grid mb-3">
          {{ primary('Send OTP', attrs={'id':'sendOtp', 'type':'button'}) }}
        </div>
        <div class="d-grid mb-3">
          {{ primary('Verify', attrs={'id':'verifyBtn', 'type':'submit', 'disabled':True}) }}
        </div>
      </form>
      {% endcall %}
    </div>
  </div>
</div>

<div class="position-fixed bottom-0 end-0 p-3" style="z-index:11">
  <div id="signupToast" class="toast text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">Account created â€” check your email</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='js/auth.js') }}"></script>
{% endblock %}
