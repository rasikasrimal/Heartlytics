{% extends 'base.html' %}
{% block title %}Sign Up{% endblock %}
{% from '_components/auth_card.html' import auth_card %}
{% from '_components/form_field.html' import form_field %}
{% from '_components/buttons.html' import primary as primary_button %}
{% from '_components/password_strength.html' import password_strength %}
{% from '_components/alerts.html' import render_flashes %}

{% block navbar %}
<nav class="navbar justify-content-end p-3">
  {% include 'components/theme_toggle.html' %}
</nav>
{% endblock %}

{% block content %}
  {{ render_flashes(get_flashed_messages(with_categories=True)) }}
  <div class="row g-0 flex-column flex-md-row align-items-stretch">
    <div class="col-md-6 col-lg-5 order-2 order-md-1 d-flex align-items-center py-4">
      {% call auth_card('Create your account') %}
        <form method="post" autocomplete="off" id="signup-form" novalidate>
          {{ form.csrf_token }}
          {{ form_field('text', 'username', 'Full Name', value=form.username.data, error=form.username.errors[0] if form.username.errors else None, attrs={'required':'','maxlength':'80', 'autocomplete':'name'}) }}
          {{ form_field('email', 'email', 'Email', value=form.email.data, error=form.email.errors[0] if form.email.errors else None, attrs={'required':'','maxlength':'120', 'autocomplete':'email'}) }}
          {{ form_field('password', 'password', 'Password', help='Use at least 8 characters with a number and symbol', error='Password is too weak', error_hidden=True, attrs={'required':'','autocomplete':'new-password','aria-describedby':'password-strength-text'}, password_toggle=True) }}
          {{ password_strength('password') }}
          {{ form_field('password', 'confirm', 'Confirm Password', error='Passwords do not match', error_hidden=True, attrs={'required':'','autocomplete':'new-password'}, password_toggle=True) }}
          <small class="text-muted d-block mb-3">By creating an account, you agree to our <a href="#">Terms</a> and <a href="#">Privacy Policy</a>.</small>
          {{ primary_button('Create account', attrs={'type':'submit','disabled':'','id':'create-account'}) }}
          <div class="mt-3">
            <span class="text-muted">Already have an account?</span> <a href="{{ url_for('auth.login') }}">Sign In</a>
          </div>
          <input type="hidden" name="role" value="User">
          {{ form.nickname(size=0, style='display:none') }}
        </form>
      {% endcall %}
    </div>
    <div class="col-md-6 order-1 order-md-2 d-md-flex align-items-center justify-content-center bg-body-secondary p-4">
      <div class="d-none d-md-block">
        <h2 class="h5 mb-3">Why join HeartLytics?</h2>
        <ul class="list-unstyled mb-0">
          <li>Track heart health trends</li>
          <li>Access personalized predictions</li>
          <li>Secure, encrypted data</li>
        </ul>
      </div>
    </div>
  </div>
  <div class="toast-container position-fixed top-0 end-0 p-3" aria-live="polite" aria-atomic="true">
    <div class="toast show"><div class="toast-body">Account created â€” check your email</div></div>
  </div>
{% endblock %}

{% block scripts %}
  <script src="{{ url_for('static', filename='js/auth.js') }}"></script>
  <script src="{{ url_for('static', filename='js/signup.js') }}"></script>
{% endblock %}
