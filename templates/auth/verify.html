{% extends 'base.html' %}
{% block title %}Enter Code{% endblock %}
{% from 'components/auth_macros.html' import auth_card, otp_inputs, primary_button, alerts, countdown_badge, link_button %}
{% block flashes %}{% endblock %}
{% block content %}
  {% set subtitle = 'Enter the 6-digit code sent to ' ~ masked_email %}
  {% call auth_card('Forgot your password?', subtitle) %}
    <form method="post" autocomplete="off" novalidate>
      {{ form.hidden_tag() }}
      {% with messages = get_flashed_messages(with_categories=true) %}
        {{ alerts(messages) }}
      {% endwith %}
      {{ otp_inputs() }}
      {{ primary_button('Continue', {'type':'submit'}) }}
    </form>
    <form method="post" action="{{ url_for('auth.resend_code') }}" class="mt-3 d-flex align-items-center gap-2 justify-content-center">
      {{ link_button('Resend', {'type':'submit'} if cooldown <= 0 else {'type':'submit','disabled':'disabled'}) }}
      {% if cooldown>0 %}
        {{ countdown_badge('%02d:%02d' % (cooldown // 60, cooldown % 60)) }}
      {% endif %}
    </form>
    <div class="text-center mt-2">
      <a href="{{ url_for('auth.forgot') }}" class="small">Change email</a>
    </div>
  {% endcall %}
  <div class="mt-3 text-center">
    <a href="{{ url_for('auth.login') }}" class="small">Back to Sign In</a>
  </div>
{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/otp.js') }}"></script>
{% endblock %}
