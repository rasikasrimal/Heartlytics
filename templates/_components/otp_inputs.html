{% macro otp_inputs(name='code', length=6) -%}
<div class="d-flex gap-2 justify-content-center mb-3" data-otp-group>
  {% for i in range(length) %}
  <input type="text" inputmode="numeric" pattern="[0-9]*" maxlength="1" class="form-control text-center" style="width:3rem;height:3rem;" id="{{ name }}{{ i }}" name="{{ name }}{{ i }}" aria-label="Digit {{ i + 1 }}">
  {% endfor %}
  <input type="hidden" name="{{ name }}" id="{{ name }}">
</div>
<script>
document.addEventListener('DOMContentLoaded',()=>{
  document.querySelectorAll('[data-otp-group]').forEach(group=>{
    const inputs=group.querySelectorAll('input[type="text"]');
    const hidden=group.querySelector('input[type="hidden"]');
    const updateHidden=()=>{hidden.value=Array.from(inputs).map(i=>i.value).join('');};
    inputs.forEach((inp,idx)=>{
      inp.addEventListener('input',e=>{
        if(e.target.value.length===1 && idx<inputs.length-1){inputs[idx+1].focus();}
        updateHidden();
      });
    });
    group.addEventListener('paste',e=>{
      const data=e.clipboardData.getData('text').replace(/\D/g,'').slice(0,inputs.length);
      data.split('').forEach((ch,i)=>{inputs[i].value=ch;});
      inputs[Math.min(data.length,inputs.length-1)].focus();
      updateHidden();
      e.preventDefault();
    });
  });
});
</script>
{%- endmacro %}
