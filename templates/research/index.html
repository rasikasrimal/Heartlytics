{% extends "base.html" %}
{% block title %}Research Paper | Heart Disease Risk{% endblock %}
{% block head %}
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
{% endblock %}
{% block content %}
  <article class="paper">
    <header class="mb-4">
      <h1 class="mb-1">{{ paper.title }}</h1>
      <p class="text-muted mb-0">{{ paper.author }}</p>
      {% if paper.affiliation %}<p class="text-muted">{{ paper.affiliation }}</p>{% endif %}
    </header>

    <section class="mb-4">
      <h2 class="h5">Abstract</h2>
      <p>{{ paper.abstract|safe }}</p>
    </section>

    <section class="mb-4">
      <h2 class="h5">Keywords</h2>
      <p>{{ paper.keywords|safe }}</p>
    </section>

    {% for sec in paper.sections %}
    <section class="mb-4">
      <h2 class="h5">{{ sec.title }}</h2>
      <div>{{ sec.content|safe }}</div>
    </section>
    {% endfor %}

    {% if paper.figures %}
    <section class="mb-4">
      <h2 class="h5">Figures</h2>
      {% for fig in paper.figures %}
        <figure class="mb-3 text-center">
          {% if fig.src.startswith('images/') and '..' not in fig.src %}
            <img src="{{ url_for('static', filename=fig.src) }}" class="img-fluid" alt="Figure {{ loop.index }}">
          {% else %}
            <div class="text-danger">Invalid figure source</div>
          {% endif %}
          <figcaption class="figure-caption">Figure {{ loop.index }}. {{ fig.caption|safe }}</figcaption>
        </figure>
      {% endfor %}
      </section>

    {% endif %}

    {% if paper.tables %}
    <section class="mb-4">
      <h2 class="h5">Tables</h2>
      {% for tab in paper.tables %}
      <div class="table-responsive mb-3">
        <table class="table table-sm table-bordered">
          <caption class="text-center">{{ tab.caption|safe }}</caption>
          <tbody>
          {% for row in tab.rows %}
            {% if loop.first %}
              <tr>{% for cell in row %}<th>{{ cell|safe }}</th>{% endfor %}</tr>
            {% else %}
              <tr>{% for cell in row %}<td>{{ cell|safe }}</td>{% endfor %}</tr>
            {% endif %}
          {% endfor %}
          </tbody>
        </table>
      </div>
      {% endfor %}
    </section>
    {% endif %}

    {% if paper.references %}
    <section class="mb-4">
      <h2 class="h5">References</h2>
      <ol>
        {% for ref in paper.references %}
        <li>{{ ref|safe }}</li>
        {% endfor %}
      </ol>
    </section>
    {% endif %}
  </article>
{% endblock %}
