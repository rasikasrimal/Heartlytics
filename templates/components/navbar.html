<nav class="navbar navbar-expand-lg bg-body border-bottom sticky-top" id="topNav">
  <!-- Use the same container width your page body uses -->
  <div class="container-xxl">
    <!-- Left group: brand + toggler -->
    <a class="navbar-brand d-flex align-items-center gap-2 me-2" href="{{ url_for('index') }}">
      <img src="{{ url_for('static', filename=app_logo) }}" alt="{{ app_name }} logo" height="28" width="28">
      <span class="fw-semibold">{{ app_name }}</span>
    </a>

    <!-- Put the hamburger next to the brand (left) -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav"
            aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Main nav: grows from the left group; me-auto pushes utilities to the right -->
    <div class="collapse navbar-collapse" id="mainNav">
      <ul class="navbar-nav ms-3 me-auto gap-3 mt-3 mt-lg-0">
        {% for item in nav_items %}
        <li class="nav-item">
          <a class="nav-link d-flex align-items-center gap-1 {% if request.endpoint == item.endpoint %}active{% endif %}"
             href="{{ url_for(item.endpoint) }}"
             {% if request.endpoint == item.endpoint %}aria-current="page"{% endif %}>
            <i class="{{ item.icon }}"></i>
            <span class="d-none d-sm-inline">{{ item.label }}</span>
          </a>
        </li>
        {% endfor %}
      </ul>
    </div>

    <!-- Right-side utilities: help, theme toggle, auth/profile -->
    <div class="d-flex align-items-center ms-3 gap-3">
      <a href="https://example.com/help" target="_blank" rel="noopener" class="btn btn-link p-0" aria-label="Help">
        <i class="bi bi-question-circle"></i>
      </a>

      {% include 'components/theme_toggle.html' %}

      {% if current_user.is_authenticated %}
      <div class="dropdown">
        <button class="btn btn-link p-0 d-flex align-items-center dropdown-toggle" id="userMenu"
                data-bs-toggle="dropdown" aria-expanded="false">
          {% if current_user.avatar %}
          <img src="{{ url_for('static', filename='avatars/' ~ current_user.avatar) }}"
               class="avatar me-1" alt="{{ current_user.nickname or current_user.username }} avatar">
          {% else %}
          <i class="bi bi-person-circle me-1"></i>
          {% endif %}
          <span class="d-none d-sm-inline">{{ current_user.nickname or current_user.username }}</span>
        </button>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenu">
          <li><a class="dropdown-item" href="{{ url_for('settings.settings') }}">Settings</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item" id="logout-link" href="{{ url_for('auth.logout') }}">Logout</a></li>
        </ul>
      </div>
      {% else %}
      <a class="nav-link" href="{{ url_for('auth.login') }}">Login</a>
      <a class="nav-link" href="{{ url_for('auth.signup') }}">Sign Up</a>
      {% endif %}
    </div>
  </div>
</nav>
